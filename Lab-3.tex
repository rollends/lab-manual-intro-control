\chapter{Bringing it Together: Lateral Motion Control}\label{Lab:3}
Imagine you are a young, aspiring, junior engineer at VenX, a private company in an alternate Universe, manufucturing a mining probe on Venus%
\footnote{This society isn't particularly concerned about the environmental impact. It isn't our planet, right?}.
Because of your junior status, they have only asked you to design a simple controller that ensures the lunar module lands at the correct location.
The controller you design controls the level of horizontal thrust to achieve a desired position relative to some point on the surface.
You may assume that all units are in standard units.
Distances are measured in meters, time is measured in seconds, mass is measured in kilograms and all other units are such that they are consistent with that.

\section{Objectives}
\begin{enumerate}[label=(\arabic*)]
  \item{
    \textbf{Use} the skills you learned in Labs~\ref{Lab:1} and~\ref{Lab:2}
    to identify parameters of an opaque, black box system.
  }
  \item{
    \textbf{Design} a proportional inner-loop controller that stabilizes the velocity and controls it to a desired value.
  }
  \item{
    \textbf{Design} a proportional outer-loop controller that stabilizes the relative position of the lunar module with respect to a set point on the ground.
  }
  \item{
    \textbf{Derive} a mathematical expression for your controller and use this to \textbf{achieve} a desired control objective.
  }
  \item{
    \textbf{Compare and contrast} your stabilizing control design with that of Lab~\ref{Lab:2}.
  }
  \item{
    \textbf{Appreciate} how your controller deals with disturbances and unmodelled dynamics.
  }
\end{enumerate}

\section{Experimental Procedure}\label{Lab:3:Experiment}
Unlike previous labs, you will now work with two Simulink models.
Moreover, this lab will involve a larger number of moving parts;
you will introduce three feedback interconnections!

In Section~\ref{Lab:3:Part:I} you will stabilize the physical plant that maps input forces to an output horizontal velocity.
You will treat velocity as the measurement (output).
You can then design a controller

\subsection{Part I: Stabilize and Identify the Plant}\label{Lab:3:Part:I}
Your deliverables for this subsection are
%
\begin{deliverable}[label={del:lab3:g1:1}]
  \textbf{Choose} and \textbf{record} a gain value \(K_1\) for your stabilizing gain.
\end{deliverable}
%
\begin{deliverable}[label={del:lab3:g1:2}]
   \textbf{Acquire} the step response from the signal labelled \(w(t)\) to the signal \(v(t)\) when the signal \(v(t)\) is connected to the \(G_1\) loop summing junction (aptly named ``\(G_1\) Loop'').
\end{deliverable}
%
\begin{deliverable}[label={del:lab3:g1:3}]
  \textbf{Measure} the time constant \(\tau_1\) of your stabilized plant using the step response acquired in Deliverable~\ref{del:lab3:g1:2}.
\end{deliverable}
%
This section concerns the Part I area of the Simulink model
\begin{center}
  \texttt{Lab\_3\_Velocity\_Controlled\_Landing\_Module.slx}.
\end{center}
In this lab, your plant is a simulated physical system.
The system has nonlinear dynamics, but we will treat it as a linear system and you will observe the power of linear control.
First, in order to even design a controller to achieve our objectives, we must stabilize the system.
The reason for this is quite simple. A physical system normally integrates the input force into velocity (and then position) and, unless there are external forces such as friction, the plant is of the form
\[
  P(s)
    =
      \frac{1}{M s}
\]
where \(M > 0\) is the mass of the landing module.
The step response of this system is unbounded.
It is true that there is friction in your model but it is often hard to model friction in reality, so we will take the above equation as our model.
To stabilize the plant, consider closing the loop in the following way
%
\begin{center}
  \begin{tikzpicture}[x=1in, y=1in]

    \node [draw, smooth_block] (Plant) {\(P(s)\)};
    \node [draw, smooth_block, left = 0.75 of Plant] (Gain1) {\(K_1\)};
    \node [draw, smooth_sum, left = 0.75 of Gain1] (Sum1) {};
    \node [right = 0.75 of Plant] (after_plant) {};
    \node [right = 0.75 of after_plant] (v) {};
    \node [left = 0.75 of Sum1] (w) {};

    \node [smooth_annotate, below = 0 of Gain1] {Stabilizing Gain};
    \node [smooth_annotate, below = 0 of Plant] {Plant};

    \draw [arrow, smooth_path]
      (Plant.east) -- (after_plant.base) -- (v.base);
    \draw [arrow, smooth_path]
      (Plant.east)
      --
      (after_plant.base)
      --
      +(0, -0.75)
      -|
      (Sum1.south)
      node [below right] {\(-\)};
    \draw [arrow, smooth_path]
      (Sum1.east)
      --
      (Gain1.west);
    \draw [arrow, smooth_path]
      (Gain1.east)
      --
      (Plant.west);
    \draw [arrow, smooth_path]
      (w.base)
      --
      (Sum1.west);
  \end{tikzpicture}
\end{center}
%
with a randomly chosen gain \(K_1 > 0.\)
The gain you choose is up to you but make sure you record it.
\begin{procedure}[label={proc:lab3:stabilize}]
  This procedure simply reiterates the steps above.
  \begin{enumerate}[label={(\arabic*)}]
    \item{%
      \textbf{Close} the loop as described above.
      You should connect the signal labelled \(v\) to the summing junction labelled ``\(G_1\) Loop.''%
    }
    \item{%
      \textbf{Choose} and \textbf{set} a random positive gain for \(K_1.\)
      The block is named ``Stabilizing Gain'' in the Simulink model.%
    }
    \item{%
      \textbf{Acquire} a step response from the signal \(w(t)\) to the signal \(v(t).\)
      Remember from Lab 2 that you need to set \(w\) as an input perturbation and \(v\) as an output measurement.
    }
    \item{%
      \textbf{Measure} the time constant of this system using the acquired step response. We will call this time constant \(\tau_1.\)
    }
  \end{enumerate}
\end{procedure}

\subsection{Part II: Reference Velocity Control Design}\label{Lab:3:Part:II}
When you performed Procedure~\ref{proc:lab3:stabilize}, you will have noticed that the step response was extremely slow.
In particular, you should notice that it took more than a minute of simulated time to achieve a speed of \SI{1}{m/s} (\SI{3.6}{km/h})!
If this is the response speed of our system, we will never be able to control it to a desired position.
In this section, you will solve this problem by designing a proportional error feedback controller that controls to a \emph{desired velocity} but with a much better time constant.
Your deliverables for this section are
%
\begin{deliverable}[label={del:lab3:g2:1}]
  \textbf{Acquire} a (unit) step response from the signal \(v_r(t)\) to the signal \(v(t).\)
  \textbf{Ensure} you have cursors that indicate the following:
  \begin{itemize}
    \item{the time constant is \(\frac{1}{\sqrt{50}} \approx 0.1414.\)}
    \item{the DC gain, or steady-state value, is \(1.\)}
  \end{itemize}
\end{deliverable}
%
This section concerns the Part II area of the Simulink model
\begin{center}
  \texttt{Lab\_3\_Velocity\_Controlled\_Landing\_Module.slx}.
\end{center}
The now stabilized plant, as a transfer function from \(w(t)\) to \(v(t),\) will be referred to as \(G_1(s)\) as is depicted below.
Verify for yourself that
\[
  G_1(s) = \frac{1}{\tau_1 s + 1}
\]
where \(\tau\) is the time constant of \(G_1(s)\) (as estimated in Deliverable~\ref{del:lab3:g1:timeconstant}).
Close the loop around \(G_1(s)\) with a proportional error feedback controller like so
%
\begin{center}
  \begin{tikzpicture}[x=1in, y=1in]

    \node [draw, smooth_block] (Plant) {\(P(s)\)};
    \node [draw, smooth_block, left = 0.25 of Plant] (Gain1) {\(K_1\)};
    \node [draw, smooth_sum, left = 0.25 of Gain1] (Sum1) {};
    \node [right = 0.25 of Plant] (after_plant) {};
    \node [right = 0.50 of after_plant] (v) {};
    \node [left = 0.50 of Sum1] (w) {};

    \draw [arrow, smooth_path]
      (Plant.east) -- (after_plant.base) -- (v.base)
      node [above right] {\(v(t)\)};
    \draw [arrow, smooth_path]
      (Plant.east)
      --
      (after_plant.base)
      --
      +(0, -0.50)
      -|
      (Sum1.south)
      node [below right] {\(-\)};
    \draw [arrow, smooth_path]
      (Sum1.east)
      --
      (Gain1.west);
    \draw [arrow, smooth_path]
      (Gain1.east)
      --
      (Plant.west);
    % \draw [arrow, smooth_path]
    %   (w.base)
    %   --
    %   (Sum1.west);

    \draw [smooth_area_path, fill = Blue, fill opacity = 0.50, text opacity = 1]
      ($(w)+(0.25, 0)$) -- +(0, 0.50) -| node[midway, above, color=Blue] {\(G_1(s)\)} ($(v)+(-0.50,0)$) -- +(0, -0.75) -| ($(w)+(0.25, 0)$);

    \node [draw, smooth_block, left = 0.25 of w] (Gain2) {\(K_2\)};
    \node [draw, smooth_sum, left = 0.50 of Gain2] (Sum2) {};
    \node [left = 0.50 of Sum2] (v_r) {};

    \draw [arrow, smooth_path]
      (Plant.east)
      --
      ($(v)+(-0.25,0)$)
      --
      +(0, -1)
      -|
      (Sum2.south)
      node [below right] {\(-\)};
    \draw [arrow, smooth_path]
      (Sum2.east)
      --
      (Gain2.west);
    \draw [arrow, smooth_path]
      (Gain2.east)
      --
      (Sum1.west);
    \draw [arrow, smooth_path]
      (v_r.base)
      --
      (Sum2.west)
      node [midway, above] {\(v_r(t)\)};

  \end{tikzpicture}
\end{center}
%
Verify that, when the loop is closed, the transfer function from \(v_r(t)\) to \(v(t),\) denoted as \(G_2(s)\) in the Simulink model, takes the form
\[
  G_2(s)
    = \frac{V(s)}{V_r(s)}
    = \frac{K_3 K_2}{1 + K_2} \frac{1}{\frac{\tau_1}{1 + K_2} s + 1}.
\]
%
\begin{procedure}[label={proc:lab3:speedup}]
  In this procedure you use another closed loop to accelerate the response of your system, thereby making it usable to do position step tracking.
  \begin{enumerate}[label={(\arabic*)}]
    \item{%
      \textbf{Close} the loop as described above.
      You should connect the signal labelled \(v\) to the summing junction labelled ``\(G_2\) Loop.''%
    }
    \item{%
      We would like to have the transfer function \(G_2(s)\) to have a time constant of \(\frac{1}{\sqrt{50}}.\)
      This would mean that, for a step change in the \emph{reference velocity}, the \emph{actual velocity} will reach \(63.3\%\) of the reference velocity in \SI{0.1414}{s}.
      Recognize that the time constant of this new closed loop system is
      \[
        \frac{\tau_1}{1 + K_2}
      \]
      where \(\tau_1\) is the time constant of \(G_1(s)\) that you measured earlier.
      As a result, \textbf{solve} for the \(K_2\) you need to have this time constant equal to \(\frac{1}{\sqrt{50}}.\)%
    }
    \item{%
      \textbf{Solve} for the gain \(K_3\) that ensures \(G_2(s)\) has a DC gain of \(1.\)%
    }
    \item{%
      \textbf{Set} the respective blocks corresponding to \(K_2\) and \(K_3\) in the Simulink diagram.%
    }
    \item{%
      \textbf{Acquire} the step response from the signal \(v_r(t)\) to the signal \(v(t).\)
      Remember again to change which signal is the input perturbation from Part I.%
    }
    \item{%
      \textbf{Place} cursors on the time constant and steady-state value to prove you met the specification.%
    }
  \end{enumerate}
\end{procedure}

\subsection{Part III: Reference Position Control Design}\label{Lab:3:Part:III}
Your deliverables for this part are
%
\begin{deliverable}[label={del:lab3:g3:1}]
   \textbf{Acquire} the step response from the signal labelled \(r(t)\) to the signal \(x(t)\) when the signal \(x(t)\) is connected to the \(G_3\) loop summing junction (aptly named ``\(G_3\) Loop'').
   This is the step response of the transfer function \(G_3(s)\) depicted in the Simulink model.
\end{deliverable}
%
\begin{deliverable}[label={del:lab3:g3:2}]
   \textbf{Run} the ``\texttt{visualize\_landing.m}'' script and \textbf{save} both Figures that are generated.
\end{deliverable}
%
\begin{deliverable}[label={del:lab3:g3:3}]
   \textbf{Acquire} the Bode plot from the signal labelled \(d(t)\) to the signal \(x(t).\)
\end{deliverable}
%
This section concerns the Part III area of the Simulink model
\begin{center}
  \texttt{Lab\_3\_Position\_Controlled\_Landing\_Module.slx}.
\end{center}
You will notice that the other Simulink model you worked with is labelled \(G_2(s)\) in this model.
Since you have designed a controller that achieves a desired reference velocity, we leverage it in this model to design an outer loop controller that achieves a desired position.
Close the loop to arrive at a diagram
%
\begin{center}
  \begin{tikzpicture}[x=1in, y=1in]

    \node [draw, smooth_block] (G2) {\(G_2(s)\)};
    \node [draw, smooth_block, right = 0.75 of G2] (Int) {\(\frac{1}{s}\)};
    \node [draw, smooth_block, left = 0.75 of G2] (Gain4) {\(K_4\)};
    \node [draw, smooth_sum, left = 0.75 of Gain4] (Sum3) {};
    \node [right = 0.25 of Int] (after_int) {};
    \node [right = 0.50 of after_int] (x) {};
    \node [left = 0.50 of Sum3] (r) {};

    \draw [arrow, smooth_path]
      (G2.east) -- (Int.west)
      node [above, midway] {\(v(t)\)};
    \draw [arrow, smooth_path]
      (Int.east) -- (after_int.base) -- (x.base)
      node [above] {\(x(t)\)};
    \draw [arrow, smooth_path]
      (Int.east)
      --
      (after_int.base)
      --
      +(0, -0.50)
      -|
      (Sum3.south)
      node [below right] {\(-\)};
    \draw [arrow, smooth_path]
      (Sum3.east)
      --
      (Gain4.west);
    \draw [arrow, smooth_path]
      (Gain4.east)
      --
      (G2.west);
    % \draw [arrow, smooth_path]
    %   (w.base)
    %   --
    %   (Sum1.west);

    \draw [arrow, smooth_path]
      (r.base)
      --
      (Sum3.west)
      node [midway, above] {\(r(t)\)};

  \end{tikzpicture}
\end{center}
%
If you performed Part II correctly, the transfer function \(G_2(s)\) takes the
form
\[
  G_2(s) = \frac{1}{\frac{1}{\sqrt{50}}s + 1}.
\]
Verify that the transfer function from \(r(t)\) to \(x(t),\) denoted \(G_3(s)\) in the Simulink model, equals
\[
  G_3(s) = \frac{K_4\sqrt{50}}{s^2 + \sqrt{50} s + K_4 \sqrt{50}}.
\]
%
\begin{procedure}[label={proc:lab3:regulate}]
  You will make a specific choice for \(K_4\) in this procedure and then simulate the entire non-linear system.
  \begin{enumerate}[label={(\arabic*)}]
    \item{%
      \textbf{Close} the loop as described above.
      You should connect the signal \(x(t)\) to the \(G_3\) loop summing junction (aptly named ``\(G_3\) loop'').%
    }
    \item{%
      \textbf{Determine} and \textbf{set} the gain \(K_4\) so that the system \(G_3(s)\) is critically damped.
      To be clear, with your choice of \(K_4\) you should find that \(\zeta = 1\) when \(G_3(s)\) is put in standard form.%
    }
    \item{%
      \textbf{Acquire} the (unit) step response from the signal \(r(t)\) to the signal \(x(t).\)
      Remember to go into the other model file and remove any annotations you have used there before setting new ones in this model file.%
    }
    \item{%
      \textbf{Run} the ``\texttt{visualize\_landing.m}'' script and \textbf{save} both Figures that are generated.%
      \emph{Do not be alarmed that the behaviour does not look like the step response.}
    }
  \end{enumerate}
\end{procedure}
%
In the following procedure, be very careful where you place your annotations, and make sure to save your diagram before running the Model Linearizer.
You must complete the previous procedure before starting this final procedure.
%
\begin{procedure}[label={proc:lab3:disturbance}]
  In this procedure, you will acquire the Bode plot from the input force \(u(t)\) to the output position \(x(t).\)
  \begin{enumerate}[label={(\arabic*)}]
    \item{%
      \textbf{Ensure} you completed Procedure~\ref{proc:lab3:regulate}.
    }
    \item{%
      \textbf{Remove} all annotations from all signals in \emph{both} Simulink models.
    }
    \item{%
      \textbf{Set} the input perturbation annotation for the signal \(d(t)\) that is added into the signal right before the Plant block.
      \(d(t)\) is the signal coming out of the ``Disturbance Signal'' block.
    }
    \item{%
      \textbf{Set} the output measurement annotation for the signal \(x(t)\) right after the integrator block (found in the ``Position'' Simulink model).
    }
    \item{%
      \textbf{Acquire} the Bode plot.
    }
  \end{enumerate}
\end{procedure}
%

\section{Report Deliverable}
Wow you made it through the Lab 3 experiment! Good job! As usual, you are expected to submit a report demonstrating that you completed the lab and that you understand the tasks performed.
In addition to including
\begin{itemize}
  \item{Deliverable~\ref{del:lab3:g1:1},}
  \item{Deliverable~\ref{del:lab3:g1:2},}
  \item{Deliverable~\ref{del:lab3:g1:3},}
  \item{Deliverable~\ref{del:lab3:g2:1},}
  \item{Deliverable~\ref{del:lab3:g3:1},}
  \item{Deliverable~\ref{del:lab3:g3:2} and}
  \item{Deliverable~\ref{del:lab3:g3:3}}
\end{itemize}
in your report, you are required to answer the questions of the following deliverable.
Make sure to leverage your other deliverables in your answers!
\begin{deliverable}[label={lab3:report}]
  \begin{enumerate}[label={(\arabic*)}]
    \item{%
      In Part III of the lab, it was discussed that you can verify
      the transfer function \(G_3(s)\) from \(r(t)\) to \(x(t)\) of the entire closed loop system equals
      \[
        G_3(s) = \frac{K_4\sqrt{50}}{s^2 + \sqrt{50} s + K_4 \sqrt{50}}.
      \]
      \textbf{Show} this computation. You may use the fact that
      \[
        G_2(s) = \frac{1}{\frac{1}{\sqrt{50}}s + 1}.
      \]
      \label{lab3:report:q1}
    }
    \item{%
      The entire closed loop system \(G_3(s)\) can be described by the diagram in Figure~\ref{fig:lab3:entire}.
      \textbf{Derive} the transfer function from \(r(t)\) to \(x(t)\)
      in terms of the \emph{symbols} \(K_1,\) \(K_2,\) \(K_3,\) \(K_4,\) and \(M.\)
      Leave your answer in symbolic form.
      \emph{It is not required, but it is wise to verify your answer with your answer in~\ref{lab3:report:q1}. They should be consistent.}
      \label{lab3:report:q2}
    }
    \item{%
      You should find that the transfer function that you derived in~\ref{lab3:report:q2} was a second-order transfer function with no zero.
      \textbf{Write} the transfer function of~\ref{lab3:report:q2} in standard second order form by deducing what its DC gain \(\hat{K},\) natural frequency \(\omega_n\) and damping ratio \(\zeta\) are in terms of the symbols \(K_1,\) \(K_2,\) \(K_3,\) \(K_4,\) and \(M.\)
      Leave your answer in symbolic form.
      \label{lab3:report:q3}
    }
    \item{%
      Unlike in Lab 2, you can change the settling time of the final, second order transfer function from \(r(t)\) to \(y(t).\)
      Leveraging the formula that estimates the \(2\%\) settling time
      \[
        T_{2\%} \approx \frac{4}{\zeta \omega}
      \]
      for a transfer function in standard form \textbf{identify} the two gains that affect the settling time of your transfer function \(G_3(s)\) (use the standard form derived in~\ref{lab3:report:q3}) .
      \label{lab3:report:q4}
    }
    \item{%
      To produce Deliverable~\ref{del:lab3:g3:2}, you simulated the true response of your controller against the complete, nonlinear system;
      not a linear approximation of it!
      The Model Linearizer performs a linear approximation of the nonlinear differential equation found in the Plant block.
      It then gives you the step response of the corresponding linear system's transfer function.
      As a result, you designed against only an approximation of the true system.
      This explains why you will have observed a modest to large overshoot of the target horizontal position before the landing module settles.
      That doesn't mean linear system theory is completely useless, however.
      \textbf{Determine} a gain that you can change to reduce the overshoot.
      \textbf{Justify} your explanation using your solution to~\ref{lab3:report:q3} and make sure to include whether you would increase or decrease that gain.
      \emph{It is not required, but I highly recommend you give it a try and see if it works. You might be surprised!}
      \label{lab3:report:q5}
    }
    \item{%
      As mentioned in~\ref{lab3:report:q5}, to produce Deliverable~\ref{del:lab3:g3:2} you simulated your control design against the real system.
      The engineers at VenX included in that model a wind force, that increases in magnitude as you get closer to the ground \emph{and} has some sinusoidal variability in speed.
      As part of the specification, the engineers would like to know just how large of a force we can afford.

      Since wind is just an additional force, and \(u(t)\) is really just an input force, we can model this wind force as simply an additional signal \(d(t)\) that is added to the input of the Plant \(u(t).\)
      Assume
      \[
        d(t) = M + A\sin\left(\pi t\right),
      \]
      where \(M, A > 0\).
      Using the Bode plot you acquired in Deliverable~\ref{del:lab3:g3:3},
      \textbf{justify} why you did not notice this sinusoidal force in your response acquired in Deliverable~\ref{lab3:report:q5}.
      \textbf{Specifically determine} how large \(A\) would have to be to observe a sinusoid of amplitude \SI{1}{m} in the output.
      \label{lab3:report:q6}
    }
    \item{%
      The software developers at VenX want your controller to have \(x(t),\) your horizontal position, to track perfectly any constant reference position \(r(t).\)

      Does your control system (treating \(r(t)\) as the input and \(x(t)\) as the output) do this?
      If yes, does it matter what the constants \(K_1,\) \(K_2,\) \(K_3,\) \(K_4,\) and \(M\) are?
      \textbf{Justify} using the theory learned in the course.
      \emph{Use the transfer function you derived in~\ref{lab3:report:q3} to answer the question.}
      \label{lab3:report:q7}
    }
    \item{%
      The philosophy of this control design was to (1) design a controller that regulates a desired velocity fast enough by controlling the input force and (2) design a controller that regulates a desired position by controlling the desired velocity.
      This is a very common technique used in aerospace since it breaks the control design into individual chunks.
      With this philosophy in mind, answer the following question as best as you possibly can:

      Your supervisor at the company VenX saw your Deliverable~\ref{del:lab3:g3:2} and was left aghast.
      They think the g-force imparted by your controller is too large and could damage delicate components that are deployed on descent.
      How could you decrease the g-force imparted by your controllers?
      \label{lab3:report:q8}
    }
  \end{enumerate}
\end{deliverable}

\begin{figure}
  \centering
  \begin{tikzpicture}[x=1in, y=1in]
    \node[smooth_block] (Plant) {\(\frac{K_1}{M s}\)};
    \node[smooth_sum, left = 0.3 of Plant] (Sum1) {};
    \node[smooth_block, left = 0.3 of Sum1] (K2) {\(K_2\)};
    \node[smooth_sum, left = 0.3 of K2] (Sum2) {};
    \node[smooth_block, left = 0.3 of Sum2] (K3K4) {\(K_4 K_3\)};
    \node[smooth_sum, left = 0.3 of K3K4] (Sum3) {};
    \node[left = 0.3 of Sum3] (r) {};
    \node[right = 0.3 of Plant] (afterPlant) {};
    \node[smooth_block, right = 0.3 of afterPlant] (Int) {\(\frac{1}{s}\)};
    \node[right = 0.3 of Int] (afterInt) {};
    \node[right = 0.3 of afterInt] (y) {};

    \draw[smooth_path, arrow]
      (r.base)
      node[above] {\(r(t)\)}
      --
      (Sum3.west);
    \draw[smooth_path, arrow]
      (Sum3.east)
      --
      (K3K4.west);
    \draw[smooth_path, arrow]
      (K3K4.east)
      --
      (Sum2.west);
    \draw[smooth_path, arrow]
      (Sum2.east)
      --
      (K2.west);
    \draw[smooth_path, arrow]
      (K2.east)
      --
      (Sum1.west);
    \draw[smooth_path, arrow]
      (Sum1.east)
      --
      (Plant.west);
    \draw[smooth_path, arrow]
      (Plant.east)
      --
      (afterPlant.base)
      --
      (Int.west);
    \draw[smooth_path, arrow]
      (Int.east)
      --
      (afterInt.base)
      --
      (y.base)
      node[above] {\(y(t)\)};
    \draw[smooth_path, arrow]
      (Int.east)
      --
      (afterInt.base)
      --
      +(0, -1)
      -|
      (Sum3.south);
    \draw[smooth_path, arrow]
      (Plant.east)
      --
      (afterPlant.base)
      --
      +(0, -0.50)
      -|
      (Sum1.south)
      node[below right] {\(-\)};
    \draw[smooth_path, arrow]
      (Plant.east)
      --
      (afterPlant.base)
      --
      +(0, -0.75)
      -|
      (Sum2.south)
      node[below right] {\(-\)};

  \end{tikzpicture}
  \caption[Closed Loop system for Lab 3]{Entire closed loop architecture for Lab 3.}
  \label{fig:lab3:entire}
\end{figure}

\subsection{Grading Scheme}
The grading scheme is shown in Table~\ref{tab:lab3:grading}. The breakdown of
your grade is shown per deliverable except in the case of the lab
questions where it is shown per question.
%
\begin{table}
\centering
\begin{tabular}{c|l|c}
        & Deliverable           & Marks  \\ \hline
        & \ref{del:lab3:g1:1}         & 4       \\ \hline
        & \ref{del:lab3:g1:2}         & 4      \\ \hline
        & \ref{del:lab3:g1:3}        & 4       \\ \hline
        & \ref{del:lab3:g2:1}        & 4       \\ \hline
        & \ref{del:lab3:g3:1}         & 4      \\ \hline
        & \ref{del:lab3:g3:2}         & 8       \\ \hline
        & \ref{del:lab3:g3:3}         & 4       \\ \hhline{=|=|=}
Lab Subtotal&                       & 28      \\ \hhline{=|=|=}
        & \ref{lab3:report}~\ref{lab3:report:q1}  & 4       \\ \hline
        & \ref{lab3:report}~\ref{lab3:report:q2}  & 4       \\ \hline
        & \ref{lab3:report}~\ref{lab3:report:q3}  & 1       \\ \hline
        & \ref{lab3:report}~\ref{lab3:report:q4}  & 2       \\ \hline
        & \ref{lab3:report}~\ref{lab3:report:q5}  & 2      \\ \hline
        & \ref{lab3:report}~\ref{lab3:report:q6}  & 5      \\ \hline
        & \ref{lab3:report}~\ref{lab3:report:q7}  & 4      \\ \hline
        & \ref{lab3:report}~\ref{lab3:report:q8}  & 3       \\ \hhline{=|=|=}
Report Subtotal&  & 25 \\ \hhline{=|=|=}
  Total &                       & 53
\end{tabular}
\caption[Grading Scheme for Lab 3]{Grading scheme for Lab 3.}
\label{tab:lab3:grading}
\end{table}
%
